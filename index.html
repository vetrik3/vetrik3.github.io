<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pravidl√° spoloƒçn√©ho b√Ωvania</title>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #111824;
      --muted: #9fb0c2;
      --text: #e8eef6;
      --accent: #7cd4ff;
      --good: #6ee7b7;
      --warn: #fbbf24;
      --bad: #fb7185;
      --border: rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(124,212,255,.18), transparent 55%),
        radial-gradient(800px 500px at 95% 20%, rgba(110,231,183,.10), transparent 60%),
        radial-gradient(800px 600px at 40% 110%, rgba(251,191,36,.10), transparent 60%),
        var(--bg);
    }
    a { color: var(--accent); }
    header {
      padding: 46px 20px 22px;
      max-width: 1100px;
      margin: 0 auto;
    }
    .title {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }
    h1 {
      margin: 0;
      font-size: clamp(28px, 3vw, 44px);
      letter-spacing: -0.02em;
    }
    .subtitle {
      margin: 10px 0 0;
      color: var(--muted);
      max-width: 70ch;
      line-height: 1.55;
    }
    .actions {
      display:flex;
      gap:10px;
      flex-wrap: wrap;
    }
    button {
      appearance: none;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: none;
      transition: transform .06s ease, background .2s ease;
      font-weight: 600;
    }
    button:hover { background: rgba(255,255,255,.10); }
    button:active { transform: translateY(1px); }
    button.primary {
      background: rgba(124,212,255,.15);
      border-color: rgba(124,212,255,.35);
      color: var(--accent);
    }
    button.primary:hover { background: rgba(124,212,255,.25); }
    button.danger {
      background: rgba(251,113,133,.12);
      border-color: rgba(251,113,133,.3);
      color: var(--bad);
    }
    button.danger:hover { background: rgba(251,113,133,.22); }
    button.success {
      background: rgba(110,231,183,.12);
      border-color: rgba(110,231,183,.3);
      color: var(--good);
    }
    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px 52px;
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
    }
    @media (max-width: 980px) {
      .wrap { grid-template-columns: 1fr; }
    }
    .full-width { grid-column: 1 / -1; }
    .card {
      background: rgba(17,24,36,.85);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card h2 {
      margin: 0;
      padding: 16px 18px;
      font-size: 18px;
      border-bottom: 1px solid var(--border);
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .card .content {
      padding: 16px 18px 18px;
    }
    .pill {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      white-space: nowrap;
    }
    .pill.green { color: var(--good); border-color: rgba(110,231,183,.3); background: rgba(110,231,183,.07); }
    .pill.yellow { color: var(--warn); border-color: rgba(251,191,36,.3); background: rgba(251,191,36,.07); }
    .pill.red { color: var(--bad); border-color: rgba(251,113,133,.3); background: rgba(251,113,133,.07); }
    .grid2 {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 720px) {
      .grid2 { grid-template-columns: 1fr; }
    }
    .rule {
      border: 1px dashed rgba(255,255,255,.14);
      border-radius: 14px;
      padding: 12px 12px 10px;
      background: rgba(255,255,255,.03);
    }
    .rule h3 {
      margin: 0 0 8px;
      font-size: 14px;
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .dot {
      width:10px; height:10px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(124,212,255,.15);
      flex: 0 0 auto;
    }
    .rule ul {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.55;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
      border-radius: 12px;
    }
    th, td {
      border-bottom: 1px solid rgba(255,255,255,.10);
      padding: 10px 10px;
      text-align: left;
      vertical-align: top;
    }
    th {
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .08em;
    }
    tr:last-child td { border-bottom: none; }
    .small {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }
    input[type="text"], input[type="date"], input[type="number"], select, textarea {
      width: 100%;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      outline: none;
      font-family: var(--sans);
      font-size: 14px;
      transition: border-color .2s;
    }
    input[type="text"]:focus, input[type="date"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
      border-color: rgba(124,212,255,.4);
    }
    select option { background: #1a2333; }
    textarea { min-height: 110px; resize: vertical; }
    label {
      display:block;
      color: var(--muted);
      font-size: 12px;
      margin: 10px 0 6px;
      text-transform: uppercase;
      letter-spacing: .08em;
      font-weight: 700;
    }
    .checklist {
      display:grid;
      gap: 10px;
    }
    .item {
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 10px 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 12px;
    }
    .item input { margin-top: 2px; }
    .item .meta { flex:1; }
    .item .meta strong { display:block; font-size: 14px; margin-bottom: 4px; }
    .item .meta span { color: var(--muted); font-size: 13px; line-height: 1.45; }
    .footer {
      max-width: 1100px;
      margin: 10px auto 0;
      padding: 0 20px 30px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }
    .badge {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      font-size: 12px;
      color: var(--muted);
    }
    .badge b { color: var(--text); }
    .ok { color: var(--good); }
    .warn { color: var(--warn); }
    .bad { color: var(--bad); }

    /* ---- Pokladnica ---- */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    .stat-box {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 16px;
      background: rgba(255,255,255,.03);
    }
    .stat-box .stat-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--muted);
      font-weight: 700;
      margin-bottom: 6px;
    }
    .stat-box .stat-val {
      font-size: 24px;
      font-weight: 700;
      font-family: var(--mono);
    }
    .stat-box .stat-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.65);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      backdrop-filter: blur(4px);
    }
    .modal {
      background: #141e2c;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      width: 100%;
      max-width: 460px;
      box-shadow: 0 20px 60px rgba(0,0,0,.6);
    }
    .modal h3 { margin: 0 0 16px; font-size: 18px; }
    .modal-footer {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 16px;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .inventory-grid {
      display: grid;
      gap: 10px;
    }
    .inv-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
    }
    .inv-item .inv-icon {
      font-size: 22px;
      flex: 0 0 auto;
    }
    .inv-item .inv-info {
      flex: 1;
      min-width: 0;
    }
    .inv-item .inv-name {
      font-weight: 600;
      font-size: 14px;
    }
    .inv-item .inv-meta {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    .inv-item .inv-actions {
      display: flex;
      gap: 6px;
      flex: 0 0 auto;
    }
    .inv-item button {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 8px;
    }
    .inv-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 999px;
      margin-top: 4px;
    }
    .inv-status.ok { background: rgba(110,231,183,.1); color: var(--good); border: 1px solid rgba(110,231,183,.25); }
    .inv-status.warn { background: rgba(251,191,36,.1); color: var(--warn); border: 1px solid rgba(251,191,36,.25); }
    .inv-status.bad { background: rgba(251,113,133,.1); color: var(--bad); border: 1px solid rgba(251,113,133,.25); }
    .tx-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }
    .tx-row:last-child { border-bottom: none; }
    .tx-icon {
      width: 36px; height: 36px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      flex: 0 0 auto;
      background: rgba(255,255,255,.06);
    }
    .tx-info { flex: 1; min-width: 0; }
    .tx-title { font-size: 14px; font-weight: 600; }
    .tx-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .tx-amount {
      font-family: var(--mono);
      font-weight: 700;
      font-size: 15px;
      flex: 0 0 auto;
      white-space: nowrap;
    }
    .sync-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 12px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      margin-bottom: 14px;
      font-size: 13px;
      flex-wrap: wrap;
    }
    .sync-bar .sync-status { flex: 1; color: var(--muted); }
    .debt-grid {
      display: grid;
      gap: 8px;
    }
    .debt-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size: 14px;
    }
    .debt-row .debt-who { color: var(--muted); }
    .debt-row .debt-amount { font-family: var(--mono); font-weight: 700; }
    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 14px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 12px;
    }
    .tab {
      padding: 7px 14px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      transition: all .2s;
    }
    .tab.active {
      background: rgba(124,212,255,.12);
      border-color: rgba(124,212,255,.3);
      color: var(--accent);
    }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .config-section {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255,255,255,.02);
      margin-bottom: 14px;
    }
    .config-section h4 { margin: 0 0 10px; font-size: 14px; color: var(--muted); text-transform: uppercase; letter-spacing: .06em; font-size: 11px; }

    @media print {
      body { background: #fff; color: #000; }
      .card { box-shadow:none; background:#fff; border:1px solid #ddd; }
      .subtitle, .small, .rule ul, .footer, th { color:#333 !important; }
      button, .actions, .modal-overlay, .sync-bar { display:none !important; }
      .wrap { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div>
        <h1>Pravidl√° spoloƒçn√©ho b√Ωvania</h1>
        <p class="subtitle">
          Tento dokument je pre 4 ƒæud√≠ v spoloƒçnom byte. <br>Cieƒæ: menej chaosu, menej h√°dok, viac ƒçistoty a pohody.
        </p>
      </div>
      <div class="actions">
        <button id="btnPrint">Tlaƒçi≈• / PDF</button>
        <button id="btnReset">Resetova≈• zmeny</button>
      </div>
    </div>
  </header>

  <main class="wrap">

    <!-- ===== 1. Z√°kladn√© pravidl√° ===== -->
    <section class="card">
      <h2>1) Z√°kladn√© pravidl√° <span class="pill">verzia: 1.0</span></h2>
      <div class="content grid2">
        <div class="rule">
          <h3><span class="dot"></span> Kuchy≈àa (po sebe)</h3>
          <ul>
            <li>Riady um√Ωvam <b>hneƒè</b> alebo najnesk√¥r do 2 hod√≠n.</li>
            <li>Zvy≈°ky jedla zachyten√© v sitku vyhod√≠m a sitko opl√°chnem.</li>
            <li>Linku, spor√°k a drez <b>utriem</b>.</li>
            <li>Po pou≈æit√≠ kanvice vodu vylejem.</li>
            <li>Jedlo v chladniƒçke oznaƒç√≠m (meno + d√°tum). Pokazen√© veci vyhadzujem.</li>
          </ul>
        </div>
        <div class="rule">
          <h3><span class="dot"></span> K√∫peƒæ≈àa / sprcha / va≈àa</h3>
          <ul>
            <li>Po sprche nech√°m priestor ƒçist√Ω, sprchov√∫ hlavu naklon√≠m.</li>
            <li>Vlasy/chlpy z odtoku a podlahy v≈ædy do ko≈°a.</li>
            <li>Uter√°ky nenech√°vame na podlahe; ve≈°iame na su≈°iak/radi√°tor.</li>
            <li>Radi√°tor ned√°vame na maximum, hrozia pop√°leniny.</li>
          </ul>
        </div>
        <div class="rule">
          <h3><span class="dot"></span> WC</h3>
          <ul>
            <li>Po spl√°chnut√≠ skontrolujem misu (kefa ak treba).</li>
            <li>Keƒè je m√°lo toaletn√©ho papiera, dopln√≠m.</li>
            <li>Do WC nepatria zvy≈°ky jedla, rad≈°ej k√¥≈°.</li>
          </ul>
        </div>
        <div class="rule">
          <h3><span class="dot"></span> Noƒçn√Ω kƒæud &amp; re≈°pekt</h3>
          <ul>
            <li>Noƒçn√Ω kƒæud: <b>22:00 ‚Äì 07:00</b>.</li>
            <li>Praƒçka a varenie do <b>22:00</b>.</li>
            <li>S dverami neb√∫chame. Vracanie mimo noƒçn√©ho kƒæudu potichu.</li>
          </ul>
        </div>
        <div class="rule">
          <h3><span class="dot"></span> Svetl√°, energia, bezpeƒçnos≈•</h3>
          <ul>
            <li>Odch√°dzam z miestnosti = <b>zhasnem</b>.</li>
            <li>Po varen√≠ vypnem spor√°k a skontrolujem.</li>
            <li>Pr√°ƒçka: dvierka a n√°dobku pootvoren√© kv√¥li plesniam.</li>
          </ul>
        </div>
        <div class="rule">
          <h3><span class="dot"></span> N√°v≈°tevy</h3>
          <ul>
            <li>N√°v≈°tevu hl√°si≈• netreba. Ticho veƒçer re≈°pektujem.</li>
            <li>Ak u m≈àa niekto presp√≠, rie≈°im poriadok po sebe.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ===== 2. Rie≈°enie probl√©mov ===== -->
    <section class="card">
      <h2>2) Ako rie≈°ime probl√©my <span class="pill">bez dr√°my</span></h2>
      <div class="content">
        <div class="grid2">
          <div class="rule">
            <h3><span class="dot"></span> 24-hodinov√© pravidlo</h3>
            <ul>
              <li>Keƒè nieƒço vad√≠, poviem to do 24 hod√≠n (slu≈°ne, konkr√©tne).</li>
              <li>Nezbierame frustr√°ciu "do z√°soby".</li>
            </ul>
          </div>
          <div class="rule">
            <h3><span class="dot"></span> Konkr√©tne, nie osobn√©</h3>
            <ul>
              <li>"Vƒçera ostali riady v dreze" namiesto "Ty si bordel√°r".</li>
              <li>Navrhneme rie≈°enie alebo zmenu pravidla.</li>
            </ul>
          </div>
        </div>
        <p class="small" style="margin-top:10px">
          Ak sa to opakuje: dohoda na "dom√°cej porade" (10 min), pr√≠padne rot√°cia √∫loh.
        </p>
      </div>
    </section>

    <!-- ===== 3. Rot√°cia upratovania ===== -->
    <aside class="card">
      <h2>3) Men√° &amp; rot√°cia upratovania <span class="pill">automaticky</span></h2>
      <div class="content">
        <p class="small">Tabuƒæka sa prepoƒç√≠ta podƒæa aktu√°lneho t√Ω≈æd≈àa.</p>
        <div class="grid2" style="display:none">
          <input id="name1" type="text" placeholder="Helen" />
          <input id="name2" type="text" placeholder="Sabo" />
          <input id="name3" type="text" placeholder="Filip" />
          <input id="name4" type="text" placeholder="Tomas" />
        </div>
        <label>Zaƒçiatok rot√°cie (pondelok)</label>
        <input id="startDate" type="date" />
        <div style="height:10px"></div>
        <div class="badge"><span class="ok">‚óè</span><b>Tip:</b> Ka≈æd√Ω t√Ω≈æde≈à sa pos√∫va o 1 miesto.</div>
        <div style="height:12px"></div>
        <table aria-label="Rozpis upratovania">
          <thead><tr><th>Oblas≈•</th><th>Kedykoƒævek tento t√Ω≈æde≈à</th></tr></thead>
          <tbody id="rotaBody"></tbody>
        </table>
      </div>
    </aside>

    <!-- ===== 4. Checklisty ===== -->
    <section class="card">
      <h2>4) Checklisty (r√Ωchla kontrola)</h2>
      <div class="content">
        <div class="checklist" id="checklists"></div>
        <p class="small" style="margin-top:10px">Tieto checkboxy s√∫ len pomocn√≠k. (Ukladaj√∫ sa lok√°lne v prehliadaƒçi.)</p>
      </div>
    </section>

    <!-- ===== 5. POKLADNICA ===== -->
    <section class="card full-width">
      <h2>
        5) üí∞ Pokladnica bytu
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <span class="pill" id="syncStatusPill">‚öô Nenastaven√©</span>
          <button id="btnSyncConfig">üë§ Moje meno</button>
          <button id="btnRefresh">‚Üª Obnovi≈•</button>
          <button id="btnAddTx">+ Platba</button>
          <button id="btnAddDeposit2">üí≥ Vklad</button>
          <button id="btnAddInv">+ Polo≈æka invent√°ra</button>
        </div>
      </h2>
      <div class="content">

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" data-tab="overview">Prehƒæad</button>
          <button class="tab" data-tab="inventory">üß¥ Invent√°r</button>
          <button class="tab" data-tab="deposits">üí≥ Vklady na √∫ƒçet</button>
          <button class="tab" data-tab="history">üìã Hist√≥ria platieb</button>
          <button class="tab" data-tab="debts">‚öñÔ∏è Dlhy</button>
        </div>

        <!-- OVERVIEW -->
        <div class="tab-panel active" id="tab-overview">
          <div class="stats-grid" id="statsGrid"></div>
          <div style="display:flex;align-items:center;gap:12px;padding:12px 16px;border:1px solid rgba(124,212,255,.25);border-radius:14px;background:rgba(124,212,255,.06);margin-top:14px;flex-wrap:wrap">
            <span style="font-size:18px">&#127974;</span>
            <div>
              <div style="font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);font-weight:700;margin-bottom:3px">ƒå√≠slo √∫ƒçtu (IBAN)</div>
              <div style="font-family:var(--mono);font-size:15px;font-weight:700;color:var(--accent);letter-spacing:.04em">SK24 0900 0000 0050 3503 5898</div>
            </div>
            <button id="btnCopyIban" style="margin-left:auto;padding:7px 12px;font-size:12px">&#128203; Kop√≠rova≈•</button>
          </div>
          <p class="small" id="pokladnikInfo" style="margin:4px 0 0"></p>
        </div>

        <!-- INVENTORY -->
        <div class="tab-panel" id="tab-inventory">
          <div class="inventory-grid" id="inventoryGrid"></div>
        </div>

        <!-- DEPOSITS -->
        <div class="tab-panel" id="tab-deposits">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;flex-wrap:wrap;gap:10px">
            <p class="small" style="margin:0">Vklady na spoloƒçn√Ω √∫ƒçet. Zostatok = vklady ‚àí v√Ωdavky.</p>
            <button class="primary" id="btnAddDeposit">+ Vklad</button>
          </div>
          <div id="depositList"></div>
        </div>

        <!-- HISTORY -->
        <div class="tab-panel" id="tab-history">
          <div id="txList"></div>
        </div>

        <!-- DEBTS -->
        <div class="tab-panel" id="tab-debts">
          <p class="small" style="margin-bottom:12px">Koƒæko kto prispel vs. spravodliv√Ω podiel (rovnomerne rozdelen√© v√Ωdavky).</p>
          <div class="debt-grid" id="debtGrid"></div>
          <p class="small" style="margin-top:12px" id="debtNote"></p>
        </div>

      </div>
    </section>

  </main>

  <div class="footer">
    <div class="badge"><span class="warn">‚óè</span><b>Mini checklist pri odchode z bytu:</b> okn√° zavret√©, spor√°k vypnut√Ω, svetl√° zhasnut√©, dvere zamknut√©.</div>
  </div>

  <!-- ===== MODALS ===== -->

  <!-- Identity modal -->
  <div class="modal-overlay" id="modalSync" style="display:none">
    <div class="modal">
      <h3>üë§ Kto som ja?</h3>
      <p class="small" style="margin-bottom:16px">
        Vyber svoje meno ‚Äî bude sa ukazova≈• pri platb√°ch a n√°kupoch.
      </p>
      <label>Moje meno</label>
      <select id="cfgMyName">
        <option value="Helen">Helen</option>
        <option value="Samo">Samo</option>
        <option value="Filip">Filip</option>
        <option value="Tomas" selected>Tomas</option>
      </select>
      <label>Kto je pokladn√≠k</label>
      <select id="cfgTreasurer">
        <option value="Helen">Helen</option>
        <option value="Samo">Samo</option>
        <option value="Filip">Filip</option>
        <option value="Tomas" selected>Tomas</option>
      </select>
      <div class="modal-footer">
        <button id="btnSyncCancel">Zru≈°i≈•</button>
        <button class="primary" id="btnSyncSave">Ulo≈æi≈• a naƒç√≠ta≈•</button>
      </div>
    </div>
  </div>

  <!-- Add deposit modal -->
  <div class="modal-overlay" id="modalDeposit" style="display:none">
    <div class="modal">
      <h3>üí≥ Vklad na spoloƒçn√Ω √∫ƒçet</h3>
      <label>Suma na osobu (‚Ç¨)</label>
      <input type="number" id="depAmount" placeholder="20.00" min="0" step="0.01" />
      <label>D√°tum</label>
      <input type="date" id="depDate" />
      <label>Kto vlo≈æil</label>
      <div id="depPayerChecks" style="display:grid;gap:8px;margin-top:4px"></div>
      <label style="margin-top:12px">Pozn√°mka (nepovinn√©)</label>
      <input type="text" id="depNote" placeholder="napr. mesaƒçn√Ω pr√≠spevok, janu√°r" />
      <div class="modal-footer">
        <button id="btnDepCancel">Zru≈°i≈•</button>
        <button class="primary" id="btnDepSave">Ulo≈æi≈• vklady</button>
      </div>
    </div>
  </div>

  <!-- Add transaction modal -->
  <div class="modal-overlay" id="modalTx" style="display:none">
    <div class="modal">
      <h3 id="modalTxTitle">+ Nov√° platba</h3>
      <label>Popis</label>
      <input type="text" id="txDesc" placeholder="Toaletn√Ω papier, jar, ..." />
      <div class="form-row">
        <div>
          <label>Suma (‚Ç¨)</label>
          <input type="number" id="txAmount" placeholder="4.50" min="0" step="0.01" />
        </div>
        <div>
          <label>D√°tum</label>
          <input type="date" id="txDate" />
        </div>
      </div>
      <label>Kto zaplatil</label>
      <select id="txPayer"></select>
      <label>Kateg√≥ria</label>
      <select id="txCat">
        <option value="spotrebak">üß¥ Spotreb√°k (jar, papier, ...)</option>
        <option value="chemia">üßπ ƒåistiaca ch√©mia</option>
        <option value="jedlo">üçï Spoloƒçn√© jedlo/n√°poje</option>
        <option value="byt">üè† Byt (≈æiarovky, n√°radie, ...)</option>
        <option value="ine">üì¶ In√©</option>
      </select>
      <label>Pozn√°mka (nepovinn√©)</label>
      <input type="text" id="txNote" placeholder="napr. Kaufland, 2 balenia" />
      <div class="modal-footer">
        <button id="btnTxCancel">Zru≈°i≈•</button>
        <button class="primary" id="btnTxSave">Ulo≈æi≈•</button>
      </div>
    </div>
  </div>

  <!-- Add inventory item modal -->
  <div class="modal-overlay" id="modalInv" style="display:none">
    <div class="modal">
      <h3 id="modalInvTitle">+ Nov√° polo≈æka invent√°ra</h3>
      <label>N√°zov</label>
      <input type="text" id="invName" placeholder="Jar, hubky, toaletn√Ω papier, ..." />
      <div class="form-row">
        <div>
          <label>Ikona (emoji)</label>
          <input type="text" id="invIcon" placeholder="üß¥" maxlength="4" />
        </div>
        <div>
          <label>Kateg√≥ria</label>
          <select id="invCat">
            <option value="spotrebak">üß¥ Spotreb√°k</option>
            <option value="chemia">üßπ ƒåistiaca ch√©mia</option>
            <option value="ine">üì¶ In√©</option>
          </select>
        </div>
      </div>
      <label>Naposledy k√∫pen√© (d√°tum)</label>
      <input type="date" id="invDate" />
      <label>Kto k√∫pil</label>
      <select id="invBuyer"></select>
      <label>Cena (‚Ç¨, nepovinn√©)</label>
      <input type="number" id="invPrice" placeholder="0.00" min="0" step="0.01" />
      <label>Frekvencia doplnenia (v d≈àoch)</label>
      <input type="number" id="invFreq" placeholder="30" min="1" />
      <label>Pozn√°mka</label>
      <input type="text" id="invNote" placeholder="napr. Lidl, veƒæk√© balenie" />
      <div class="modal-footer">
        <button id="btnInvCancel">Zru≈°i≈•</button>
        <button class="primary" id="btnInvSave">Ulo≈æi≈•</button>
      </div>
    </div>
  </div>

  <script>
  // =====================================================================
  // CONFIG & DEFAULTS
  // =====================================================================
  const NAMES_DEFAULT = ["Helen", "Samo", "Filip", "Tomas"];

  const DEFAULT_INVENTORY = [
    { id: "inv_jar",    name: "Jar na riad",        icon: "üß¥", cat: "spotrebak", freq: 45, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_hubky",  name: "Hubky",               icon: "ü™£", cat: "spotrebak", freq: 14, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_mydlo",  name: "Tekut√© mydlo",         icon: "ü´ß", cat: "spotrebak", freq: 30, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_wc",     name: "Toaletn√Ω papier",      icon: "üßª", cat: "spotrebak", freq: 14, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_wipe",   name: "Kuchynsk√© utierky",    icon: "üóÇÔ∏è", cat: "spotrebak", freq: 21, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_wc2",    name: "WC ƒçistiƒç",            icon: "üöΩ", cat: "chemia",    freq: 30, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_wf",     name: "ƒåistiƒç podlahy / Wipes",icon: "üßπ", cat: "chemia",   freq: 30, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_bags",   name: "Smetn√© vrecia",        icon: "üóëÔ∏è", cat: "spotrebak", freq: 21, lastDate: null, lastBuyer: null, price: null, note: "" },
    { id: "inv_sponge", name: "Vonn√° tyƒçinka / sprej", icon: "üå∏", cat: "ine",      freq: 60, lastDate: null, lastBuyer: null, price: null, note: "" },
  ];

  // =====================================================================
  // STORE (localStorage)
  // =====================================================================
  const ls = {
    get(k, d) { try { const v = localStorage.getItem(k); return v === null ? d : JSON.parse(v); } catch(e) { return d; } },
    set(k, v) { try { localStorage.setItem(k, JSON.stringify(v)); } catch(e) {} },
    del(k) { localStorage.removeItem(k); }
  };

  // =====================================================================
  // STATE
  // =====================================================================
  // ‚îÄ‚îÄ JSONBin credentials (hardcoded) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const BIN_ID  = "69a071bb43b1c97be9a0cc70";
  const BIN_KEY = "$2a$10$1CvK8OmMv1yh9X/WN644duX.3y4mqU5Z5D9NYgAgI.Do1BYBO73ZO";

  let cfg = ls.get("sync_cfg", { binId: BIN_ID, apiKey: BIN_KEY, myName: "Tomas", treasurer: "Tomas" });
  // always keep credentials up to date even if localStorage had old values
  cfg.binId  = BIN_ID;
  cfg.apiKey = BIN_KEY;
  let pokladnica = {
    transactions: [],
    deposits: [],
    inventory: JSON.parse(JSON.stringify(DEFAULT_INVENTORY)),
    names: [...NAMES_DEFAULT]
  };

  // =====================================================================
  // JSONBin API
  // =====================================================================
  async function fetchFromBin() {
    if (!cfg.binId || !cfg.apiKey) return null;
    try {
      const r = await fetch(`https://api.jsonbin.io/v3/b/${cfg.binId}/latest`, {
        headers: { "X-Master-Key": cfg.apiKey }
      });
      if (!r.ok) throw new Error("fetch failed " + r.status);
      const data = await r.json();
      return data.record || null;
    } catch(e) {
      console.error("JSONBin fetch:", e);
      return null;
    }
  }

  async function saveToBin() {
    if (!cfg.binId || !cfg.apiKey) return false;
    try {
      const r = await fetch(`https://api.jsonbin.io/v3/b/${cfg.binId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json", "X-Master-Key": cfg.apiKey },
        body: JSON.stringify(pokladnica)
      });
      return r.ok;
    } catch(e) {
      console.error("JSONBin save:", e);
      return false;
    }
  }

  async function syncLoad() {
    setSyncStatus("loading");
    const data = await fetchFromBin();
    if (data) {
      // merge inventory: keep new defaults if ids not in remote
      const remoteInvIds = (data.inventory || []).map(i => i.id);
      const mergedInv = data.inventory || [];
      DEFAULT_INVENTORY.forEach(di => {
        if (!remoteInvIds.includes(di.id)) mergedInv.push(di);
      });
      pokladnica = { ...pokladnica, ...data, inventory: mergedInv, deposits: data.deposits || [] };
      setSyncStatus("ok");
    } else {
      setSyncStatus(cfg.binId ? "error" : "none");
    }
    renderAll();
  }

  async function syncSave() {
    setSyncStatus("saving");
    const ok = await saveToBin();
    setSyncStatus(ok ? "ok" : (cfg.binId ? "error" : "none"));
    renderAll();
  }

  function setSyncStatus(s) {
    const pill = document.getElementById("syncStatusPill");
    if (!pill) return;
    const map = {
      none: ["‚öô Nenastaven√©", ""],
      loading: ["‚Üª Naƒç√≠tavam...", "yellow"],
      saving: ["‚Üë Uklad√°m...", "yellow"],
      ok: ["‚úì Synced", "green"],
      error: ["‚úó Chyba sync", "red"]
    };
    const [t, cls] = map[s] || map.none;
    pill.textContent = t;
    pill.className = "pill" + (cls ? " " + cls : "");
  }

  // =====================================================================
  // RENDERING ‚Äî Pokladnica
  // =====================================================================
  function renderAll() {
    renderStats();
    renderInventory();
    renderDeposits();
    renderHistory();
    renderDebts();
    updatePokladnikInfo();
  }

  function renderStats() {
    const txs = pokladnica.transactions || [];
    const deps = pokladnica.deposits || [];
    const totalSpent = txs.reduce((s, t) => s + (t.amount || 0), 0);
    const totalDeposited = deps.reduce((s, d) => s + (d.amount || 0), 0);
    const balance = totalDeposited - totalSpent;
    const thisMonth = txs.filter(t => {
      const d = new Date(t.date);
      const now = new Date();
      return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth();
    }).reduce((s, t) => s + (t.amount || 0), 0);

    const byPerson = {};
    (pokladnica.names || NAMES_DEFAULT).forEach(n => byPerson[n] = 0);
    txs.forEach(t => { if (byPerson[t.payer] !== undefined) byPerson[t.payer] += t.amount || 0; });
    const topPayer = Object.entries(byPerson).sort((a,b) => b[1]-a[1])[0];
    const urgentInv = (pokladnica.inventory || []).filter(i => getInvStatus(i) === "bad").length;
    const balanceCls = balance >= 0 ? "ok" : "bad";

    document.getElementById("statsGrid").innerHTML = `
      <div class="stat-box" style="border-color:${balance >= 0 ? 'rgba(110,231,183,.3)' : 'rgba(251,113,133,.3)'}">
        <div class="stat-label">üí∞ Zostatok na √∫ƒçte</div>
        <div class="stat-val ${balanceCls}">‚Ç¨${balance.toFixed(2)}</div>
        <div class="stat-sub">vklady ‚Ç¨${totalDeposited.toFixed(2)} ‚àí v√Ωdavky ‚Ç¨${totalSpent.toFixed(2)}</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Celkov√© vklady</div>
        <div class="stat-val" style="color:var(--accent)">‚Ç¨${totalDeposited.toFixed(2)}</div>
        <div class="stat-sub">${deps.length} vkladov</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Celkov√© v√Ωdavky</div>
        <div class="stat-val warn">‚Ç¨${totalSpent.toFixed(2)}</div>
        <div class="stat-sub">${txs.length} platieb</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Tento mesiac v√Ωdavky</div>
        <div class="stat-val warn">‚Ç¨${thisMonth.toFixed(2)}</div>
        <div class="stat-sub">${new Date().toLocaleDateString('sk', {month:'long', year:'numeric'})}</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">üö® Ch√Ωba doplni≈•</div>
        <div class="stat-val ${urgentInv > 0 ? 'bad' : 'ok'}">${urgentInv}</div>
        <div class="stat-sub">polo≈æiek v invent√°ri</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Pokladn√≠k</div>
        <div class="stat-val" style="font-size:18px">${cfg.treasurer || "‚Äî"}</div>
        <div class="stat-sub">spravuje z√°znamy</div>
      </div>
    `;
  }

  function getInvStatus(item) {
    if (item.needsBuy) return "bad";
    if (!item.lastDate) return "bad";
    const days = Math.floor((Date.now() - new Date(item.lastDate)) / 86400000);
    const freq = item.freq || 30;
    if (days >= freq) return "bad";
    if (days >= freq * 0.75) return "warn";
    return "ok";
  }

  function renderInventory() {
    const inv = pokladnica.inventory || [];
    const grid = document.getElementById("inventoryGrid");
    if (!inv.length) { grid.innerHTML = '<p class="small">≈Ωiadne polo≈æky. Pridaj cez "+ Polo≈æka invent√°ra".</p>'; return; }
    grid.innerHTML = inv.map((item, idx) => {
      const status = getInvStatus(item);
      const labels = { ok: "OK", warn: "ƒåoskoro doplni≈•", bad: item.needsBuy ? "Treba dokupi≈•!" : (item.lastDate ? "Doplni≈•!" : "Nikdy nek√∫pen√©") };
      const days = item.lastDate ? Math.floor((Date.now() - new Date(item.lastDate)) / 86400000) : null;
      const daysText = days !== null ? `pred ${days} d≈àami` : "‚Äî";
      return `
        <div class="inv-item">
          <div class="inv-icon">${item.icon || "üì¶"}</div>
          <div class="inv-info">
            <div class="inv-name">${item.name}</div>
            <div class="inv-meta">
              Naposledy: <b>${item.lastDate || "‚Äî"}</b> (${daysText}) ¬∑ k√∫pil: <b>${item.lastBuyer || "‚Äî"}</b>
              ${item.price ? ` ¬∑ ‚Ç¨${parseFloat(item.price).toFixed(2)}` : ""}
              ${item.note ? ` ¬∑ ${item.note}` : ""}
            </div>
            <div class="inv-status ${status}">${status === "ok" ? "‚úì" : status === "warn" ? "‚ö†" : "‚úó"} ${labels[status]}</div>
          </div>
          <div class="inv-actions" style="display:grid;grid-template-columns:1fr 1fr;gap:5px;min-width:90px">
            <button onclick="markBought(${idx})" class="success" style="font-size:12px;padding:6px 8px">‚úì K√∫pen√©</button>
            <button onclick="editInvItem(${idx})" style="font-size:12px;padding:6px 8px">‚úé Upravi≈•</button>
            ${item.needsBuy
              ? `<button onclick="markNeedsBuy(${idx})" class="danger" style="font-size:12px;padding:6px 8px;opacity:.5" disabled>üõí Dokupi≈•</button>`
              : `<button onclick="markNeedsBuy(${idx})" class="danger" style="font-size:12px;padding:6px 8px">üõí Dokupi≈•</button>`
            }
            <button onclick="deleteInvItem(${idx})" class="danger" style="font-size:12px;padding:6px 8px">‚úï Zmaza≈•</button>
          </div>
        </div>
      `;
    }).join("");
  }

  function renderHistory() {
    const txs = [...(pokladnica.transactions || [])].sort((a,b) => new Date(b.date)-new Date(a.date));
    const div = document.getElementById("txList");
    if (!txs.length) { div.innerHTML = '<p class="small">≈Ωiadne platby. Pridaj cez "+ Platba".</p>'; return; }
    const catIcons = { spotrebak: "üß¥", chemia: "üßπ", jedlo: "üçï", byt: "üè†", ine: "üì¶" };
    div.innerHTML = txs.map((tx, i) => `
      <div class="tx-row">
        <div class="tx-icon">${catIcons[tx.cat] || "üì¶"}</div>
        <div class="tx-info">
          <div class="tx-title">${tx.desc}</div>
          <div class="tx-sub">${tx.date} ¬∑ ${tx.payer}${tx.note ? " ¬∑ " + tx.note : ""}</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="tx-amount ok">+‚Ç¨${(tx.amount||0).toFixed(2)}</div>
          <button onclick="deleteTx('${tx.id}')" class="danger" style="padding:4px 8px;font-size:11px">‚úï</button>
        </div>
      </div>
    `).join("");
  }

  function renderDeposits() {
    const deps = [...(pokladnica.deposits || [])].sort((a,b) => new Date(b.date)-new Date(a.date));
    const div = document.getElementById("depositList");
    if (!div) return;
    if (!deps.length) { div.innerHTML = '<p class="small">≈Ωiadne vklady. Pridaj cez "+ Vklad".</p>'; return; }
    div.innerHTML = deps.map(dep => `
      <div class="tx-row">
        <div class="tx-icon">üí≥</div>
        <div class="tx-info">
          <div class="tx-title">${dep.payer} vlo≈æil na √∫ƒçet</div>
          <div class="tx-sub">${dep.date}${dep.note ? " ¬∑ " + dep.note : ""}</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="tx-amount" style="color:var(--accent)">+‚Ç¨${(dep.amount||0).toFixed(2)}</div>
          <button onclick="deleteDeposit('${dep.id}')" class="danger" style="padding:4px 8px;font-size:11px">‚úï</button>
        </div>
      </div>
    `).join("");
  }

  function renderDebts() {
    const txs = pokladnica.transactions || [];
    const deps = pokladnica.deposits || [];
    const names = pokladnica.names || NAMES_DEFAULT;

    // Total spent ‚Äî paid from the shared account
    const totalSpent = txs.reduce((s, t) => s + (t.amount || 0), 0);
    // Fair share of expenses per person
    const fairShare = totalSpent / names.length;

    // How much each person deposited
    const deposited = {};
    names.forEach(n => deposited[n] = 0);
    deps.forEach(d => { if (deposited[d.payer] !== undefined) deposited[d.payer] += d.amount || 0; });

    // Balance per person = deposited - fairShare
    // Positive = they are ahead (paid more than their share)
    // Negative = they still owe money
    const grid = document.getElementById("debtGrid");
    grid.innerHTML = names.map(n => {
      const dep = deposited[n] || 0;
      const balance = dep - fairShare;
      const cls = balance >= -0.005 ? "ok" : "bad";
      const sign = balance >= 0 ? "+" : "";
      const statusText = balance >= -0.005
        ? (balance < 0.005 ? "Vyrovnan√Ω ‚úì" : `Preplatok ‚Ç¨${balance.toFixed(2)}`)
        : `Dlhuje ‚Ç¨${Math.abs(balance).toFixed(2)}`;
      return `
        <div class="debt-row">
          <div>
            <b>${n}</b>
            <div class="debt-who small">vlo≈æil: ‚Ç¨${dep.toFixed(2)} ¬∑ spravodliv√Ω podiel v√Ωdavkov: ‚Ç¨${fairShare.toFixed(2)}</div>
          </div>
          <div style="text-align:right">
            <div class="debt-amount ${cls}">${sign}‚Ç¨${Math.abs(balance).toFixed(2)}</div>
            <div style="font-size:11px;color:var(--muted);margin-top:2px">${statusText}</div>
          </div>
        </div>
      `;
    }).join("");

    const totalDeposited = deps.reduce((s, d) => s + (d.amount || 0), 0);
    document.getElementById("debtNote").textContent = totalSpent > 0 || totalDeposited > 0
      ? `Celkov√© v√Ωdavky: ‚Ç¨${totalSpent.toFixed(2)} ¬∑ celkov√© vklady: ‚Ç¨${totalDeposited.toFixed(2)} ¬∑ podiel/os.: ‚Ç¨${fairShare.toFixed(2)}`
      : "≈Ωiadne z√°znamy e≈°te.";
  }

  function updatePokladnikInfo() {
    const el = document.getElementById("pokladnikInfo");
    el.innerHTML = `Pokladn√≠k: <b>${cfg.treasurer || "?"}</b> ¬∑ Ja: <b>${cfg.myName || "?"}</b>`;
  }

  // =====================================================================
  // ACTIONS
  // =====================================================================
  window.markNeedsBuy = async function(idx) {
    pokladnica.inventory[idx].needsBuy = true;
    await syncSave();
  };

  window.markBought = async function(idx) {
    const item = pokladnica.inventory[idx];
    const today = new Date().toISOString().split("T")[0];
    item.lastDate = today;
    item.lastBuyer = cfg.myName || NAMES_DEFAULT[0];
    item.needsBuy = false;
    await syncSave();
  };

  window.editInvItem = function(idx) {
    openInvModal(idx);
  };

  window.deleteInvItem = async function(idx) {
    if (!confirm("Naozaj zmaza≈• t√∫to polo≈æku invent√°ra?")) return;
    pokladnica.inventory.splice(idx, 1);
    await syncSave();
  };

  window.deleteTx = async function(id) {
    if (!confirm("Naozaj zmaza≈• t√∫to platbu?")) return;
    pokladnica.transactions = pokladnica.transactions.filter(t => t.id !== id);
    await syncSave();
  };

  window.deleteDeposit = async function(id) {
    if (!confirm("Naozaj zmaza≈• tento vklad?")) return;
    pokladnica.deposits = (pokladnica.deposits || []).filter(d => d.id !== id);
    await syncSave();
  };

  // =====================================================================
  // MODALS
  // =====================================================================
  let editingInvIdx = null;

  function openTxModal() {
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("txDesc").value = "";
    document.getElementById("txAmount").value = "";
    document.getElementById("txDate").value = today;
    document.getElementById("txNote").value = "";
    fillSelect("txPayer", pokladnica.names || NAMES_DEFAULT, cfg.myName);
    document.getElementById("modalTxTitle").textContent = "+ Nov√° platba";
    document.getElementById("modalTx").style.display = "flex";
  }

  function openDepositModal() {
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("depAmount").value = "";
    document.getElementById("depDate").value = today;
    document.getElementById("depNote").value = "";
    // render checkboxes ‚Äî all unchecked by default + select all
    const names = pokladnica.names || NAMES_DEFAULT;
    const checkStyle = `display:flex;align-items:center;gap:10px;cursor:pointer;padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:rgba(255,255,255,.03);text-transform:none;letter-spacing:0;font-size:14px;font-weight:400;color:var(--text);margin:0`;
    const cbStyle = `width:16px;height:16px;flex:0 0 auto;accent-color:var(--accent)`;
    document.getElementById("depPayerChecks").innerHTML =
      `<label style="${checkStyle};border-color:rgba(124,212,255,.3);background:rgba(124,212,255,.06);font-weight:600" id="lblSelectAll">
        <input type="checkbox" id="cbSelectAll" style="${cbStyle}" />
        Oznaƒçi≈• v≈°etk√Ωch
      </label>` +
      names.map(n => `
      <label style="${checkStyle}">
        <input type="checkbox" data-name="${n}" style="${cbStyle}" />
        ${n}
      </label>
    `).join("");
    // wire select-all
    document.getElementById("cbSelectAll").onchange = function() {
      document.querySelectorAll("#depPayerChecks input[data-name]").forEach(cb => cb.checked = this.checked);
    };
    // keep select-all in sync
    document.getElementById("depPayerChecks").addEventListener("change", function(e) {
      if (e.target.dataset.name) {
        const all = [...document.querySelectorAll("#depPayerChecks input[data-name]")];
        document.getElementById("cbSelectAll").checked = all.every(cb => cb.checked);
      }
    });
    document.getElementById("modalDeposit").style.display = "flex";
  }

  function openInvModal(idx = null) {
    editingInvIdx = idx;
    fillSelect("invBuyer", pokladnica.names || NAMES_DEFAULT, cfg.myName);
    const today = new Date().toISOString().split("T")[0];
    if (idx !== null) {
      const item = pokladnica.inventory[idx];
      document.getElementById("invName").value = item.name;
      document.getElementById("invIcon").value = item.icon || "";
      document.getElementById("invCat").value = item.cat || "spotrebak";
      document.getElementById("invDate").value = item.lastDate || "";
      document.getElementById("invBuyer").value = item.lastBuyer || cfg.myName;
      document.getElementById("invPrice").value = item.price || "";
      document.getElementById("invFreq").value = item.freq || 30;
      document.getElementById("invNote").value = item.note || "";
      document.getElementById("modalInvTitle").textContent = "‚úé Upravi≈• polo≈æku";
    } else {
      document.getElementById("invName").value = "";
      document.getElementById("invIcon").value = "üì¶";
      document.getElementById("invCat").value = "spotrebak";
      document.getElementById("invDate").value = today;
      document.getElementById("invBuyer").value = cfg.myName;
      document.getElementById("invPrice").value = "";
      document.getElementById("invFreq").value = "30";
      document.getElementById("invNote").value = "";
      document.getElementById("modalInvTitle").textContent = "+ Nov√° polo≈æka";
    }
    document.getElementById("modalInv").style.display = "flex";
  }

  function fillSelect(id, names, selected) {
    const el = document.getElementById(id);
    el.innerHTML = names.map(n => `<option value="${n}" ${n===selected?"selected":""}>${n}</option>`).join("");
  }

  function openSyncModal() {
    document.getElementById("cfgMyName").value = cfg.myName || "Tomas";
    document.getElementById("cfgTreasurer").value = cfg.treasurer || "Tomas";
    document.getElementById("modalSync").style.display = "flex";
  }

  // =====================================================================
  // EVENTS
  // =====================================================================
  document.getElementById("btnSyncConfig").onclick = openSyncModal;
  document.getElementById("btnSyncCancel").onclick = () => document.getElementById("modalSync").style.display = "none";
  document.getElementById("btnSyncSave").onclick = async () => {
    cfg.myName = document.getElementById("cfgMyName").value;
    cfg.treasurer = document.getElementById("cfgTreasurer").value;
    cfg.binId = BIN_ID;
    cfg.apiKey = BIN_KEY;
    ls.set("sync_cfg", cfg);
    document.getElementById("modalSync").style.display = "none";
    updatePokladnikInfo();
    renderAll();
  };

  document.getElementById("btnRefresh").onclick = () => syncLoad();
  document.addEventListener("click", function(e) {
    if (e.target && e.target.id === "btnCopyIban") {
      navigator.clipboard.writeText("SK2409000000005035035898").then(() => {
        e.target.textContent = "‚úì Skop√≠rovan√©";
        setTimeout(() => e.target.textContent = "üìã Kop√≠rova≈•", 1800);
      });
    }
  });
  // deposit buttons (two: header + tab)
  const openDep = () => openDepositModal();
  document.getElementById("btnAddDeposit2").onclick = openDep;
  document.getElementById("btnDepCancel").onclick = () => document.getElementById("modalDeposit").style.display = "none";
  document.getElementById("btnDepSave").onclick = async () => {
    const amount = parseFloat(document.getElementById("depAmount").value);
    if (isNaN(amount) || amount <= 0) { alert("Zadaj sumu!"); return; }
    const checked = [...document.querySelectorAll("#depPayerChecks input[type=checkbox]:checked")].map(el => el.dataset.name);
    if (!checked.length) { alert("Vyber aspo≈à jednu osobu!"); return; }
    const date = document.getElementById("depDate").value;
    const note = document.getElementById("depNote").value.trim();
    if (!pokladnica.deposits) pokladnica.deposits = [];
    const base = Date.now();
    checked.forEach((name, i) => {
      pokladnica.deposits.push({
        id: "dep_" + (base + i),
        amount,
        date,
        payer: name,
        note,
        addedBy: cfg.myName
      });
    });
    document.getElementById("modalDeposit").style.display = "none";
    await syncSave();
  };
  document.getElementById("btnAddTx").onclick = openTxModal;
  document.getElementById("btnTxCancel").onclick = () => document.getElementById("modalTx").style.display = "none";
  document.getElementById("btnTxSave").onclick = async () => {
    const desc = document.getElementById("txDesc").value.trim();
    const amount = parseFloat(document.getElementById("txAmount").value);
    if (!desc || isNaN(amount) || amount <= 0) { alert("Vypl≈à popis a sumu!"); return; }
    const tx = {
      id: "tx_" + Date.now(),
      desc,
      amount,
      date: document.getElementById("txDate").value,
      payer: document.getElementById("txPayer").value,
      cat: document.getElementById("txCat").value,
      note: document.getElementById("txNote").value.trim(),
      addedBy: cfg.myName
    };
    pokladnica.transactions.push(tx);
    document.getElementById("modalTx").style.display = "none";
    await syncSave();
  };

  document.getElementById("btnAddInv").onclick = () => openInvModal(null);
  document.getElementById("btnInvCancel").onclick = () => document.getElementById("modalInv").style.display = "none";
  document.getElementById("btnInvSave").onclick = async () => {
    const name = document.getElementById("invName").value.trim();
    if (!name) { alert("Vypl≈à n√°zov!"); return; }
    const item = {
      id: editingInvIdx !== null ? pokladnica.inventory[editingInvIdx].id : "inv_" + Date.now(),
      name,
      icon: document.getElementById("invIcon").value.trim() || "üì¶",
      cat: document.getElementById("invCat").value,
      lastDate: document.getElementById("invDate").value || null,
      lastBuyer: document.getElementById("invBuyer").value || null,
      price: parseFloat(document.getElementById("invPrice").value) || null,
      freq: parseInt(document.getElementById("invFreq").value) || 30,
      note: document.getElementById("invNote").value.trim()
    };
    if (editingInvIdx !== null) {
      pokladnica.inventory[editingInvIdx] = item;
    } else {
      pokladnica.inventory.push(item);
    }
    document.getElementById("modalInv").style.display = "none";
    await syncSave();
  };

  // Close modals on overlay click
  ["modalSync","modalTx","modalInv","modalDeposit"].forEach(id => {
    document.getElementById(id).addEventListener("click", function(e) {
      if (e.target === this) this.style.display = "none";
    });
  });

  // Tabs
  document.querySelectorAll(".tab").forEach(tab => {
    tab.onclick = () => {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
      tab.classList.add("active");
      const panel = document.getElementById("tab-" + tab.dataset.tab);
      if (panel) panel.classList.add("active");
      // wire deposit tab button after tab renders
      const depBtn = document.getElementById("btnAddDeposit");
      if (depBtn && !depBtn._wired) { depBtn.onclick = openDep; depBtn._wired = true; }
    };
  });

  // =====================================================================
  // ROTATION (original logic)
  // =====================================================================
  const TASKS = [
    { area: "Kuchy≈àa + Odpad + Spotreb√°k", details: "linka, drez, spor√°k, mikrovlnka, smetn√© ko≈°e, papier, jar, hubky",
      checklist: [["Utrie≈• linku a spor√°k","Jar/odmas≈•ovaƒç, potom do sucha."],["Drez + odtok + odkvapk√°vaƒç","Vybra≈• zvy≈°ky, opl√°chnu≈• sitko."],["Odpad","Vynies≈• smeti, vyƒçisti≈• okolie ko≈°a."],["Vynies≈• trieden√Ω odpad","Plasty/papier/sklo podƒæa potreby."],["Doplni≈• papier","WC papier, kuchynsk√© utierky."],["Skontrolova≈• jar/hubku","Keƒè smrd√≠ alebo je opotrebovan√°, vymeni≈•."]]},
    { area: "K√∫peƒæ≈àa + sprcha/va≈àa + WC", details: "um√Ωvadlo, zrkadlo, sprchov√Ω k√∫t/va≈àa, misa, sed√°tko, okolie",
      checklist: [["Sprcha/va≈àa","Opl√°chnu≈•, odstr√°ni≈• vlasy, pretrie≈• usadeniny."],["Um√Ωvadlo","Vodn√Ω kame≈à okolo bat√©rie a odtoku."],["Zrkadlo","Pretrie≈• bez ≈°m√∫h."],["Misa + kefa","WC ƒçistiƒç, necha≈• p√¥sobi≈•, vydrhn√∫≈•."],["Sed√°tko + tlaƒçidlo","Dezinfekcia."]]},
    { area: "Spoloƒçn√© priestory", details: "chodba/ob√Ωvaƒçka/kuchy≈àa/k√∫peƒæ≈àa, prach, podlaha",
      checklist: [["Povrchy","St√¥l, poliƒçky, parapety."],["Podlaha","Pozameta≈•, potom mopova≈•."],["Vetranie","Kr√°tke vyvetranie (5‚Äì10 min)."]]}
  ];

  const lsStore = {
    get(k,d){ try{ const v=localStorage.getItem(k); return v===null?d:JSON.parse(v); }catch(e){return d;} },
    set(k,v){ localStorage.setItem(k,JSON.stringify(v)); }
  };

  const n1=document.getElementById("name1"),n2=document.getElementById("name2"),n3=document.getElementById("name3"),n4=document.getElementById("name4");
  const startDate=document.getElementById("startDate");

  function toISODateLocal(d){ const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,"0"),day=String(d.getDate()).padStart(2,"0"); return `${y}-${m}-${day}`; }
  function parseISODateLocal(iso){ const [y,m,d]=iso.split("-").map(Number); return new Date(y,m-1,d,0,0,0,0); }
  function mondayOf(date){ const d=new Date(date),day=(d.getDay()+6)%7; d.setDate(d.getDate()-day); d.setHours(0,0,0,0); return d; }
  function weeksBetween(a,b){ return Math.floor((mondayOf(a)-mondayOf(b))/(7*24*60*60*1000)); }
  function currentRotation(names,startISO){ const w=weeksBetween(new Date(),parseISODateLocal(startISO)),n=names.length,shift=((w%n)+n)%n; return names.slice(shift).concat(names.slice(0,shift)); }

  const DEFAULTS = {
    names:["Helen","Samo","Filip","Tomas"],
    startDate:(()=>{ const d=new Date(),day=(d.getDay()+6)%7; d.setDate(d.getDate()-day); d.setHours(0,0,0,0); return toISODateLocal(d); })()
  };

  function renderRota(){
    const names=[n1.value.trim()||DEFAULTS.names[0],n2.value.trim()||DEFAULTS.names[1],n3.value.trim()||DEFAULTS.names[2],n4.value.trim()||DEFAULTS.names[3]];
    const rota=currentRotation(names,startDate.value||DEFAULTS.startDate);
    document.getElementById("rotaBody").innerHTML="";
    TASKS.forEach((t,idx)=>{
      const who=rota[idx%rota.length];
      const tr=document.createElement("tr");
      tr.innerHTML=`<td><b>${t.area}</b><div class="small">${t.details}</div></td><td><b>${who}</b></td>`;
      document.getElementById("rotaBody").appendChild(tr);
    });
  }

  function renderChecklists(){
    const c=document.getElementById("checklists");
    c.innerHTML="";
    TASKS.forEach(t=>{
      const box=document.createElement("div");
      box.className="rule";
      box.innerHTML=`<h3><span class="dot"></span>${t.area}</h3>`;
      const wrap=document.createElement("div");
      wrap.className="checklist";
      t.checklist.forEach(([title,desc])=>{
        const key=`chk::${t.area}::${title}`;
        const checked=lsStore.get(key,false);
        const row=document.createElement("div");
        row.className="item";
        row.innerHTML=`<input type="checkbox" ${checked?"checked":""} /><div class="meta"><strong>${title}</strong><span>${desc}</span></div>`;
        row.querySelector("input").addEventListener("change",e=>lsStore.set(key,e.target.checked));
        wrap.appendChild(row);
      });
      box.appendChild(wrap);
      c.appendChild(box);
    });
  }

  function loadSettings(){
    const names=lsStore.get("names",DEFAULTS.names);
    n1.value=names[0]||DEFAULTS.names[0]; n2.value=names[1]||DEFAULTS.names[1];
    n3.value=names[2]||DEFAULTS.names[2]; n4.value=names[3]||DEFAULTS.names[3];
    startDate.value=lsStore.get("startDate",DEFAULTS.startDate);
  }

  [n1,n2,n3,n4].forEach(el=>el.addEventListener("input",()=>{
    lsStore.set("names",[n1.value,n2.value,n3.value,n4.value]);
    renderRota();
  }));
  startDate.addEventListener("change",()=>{ lsStore.set("startDate",startDate.value); renderRota(); });

  document.getElementById("btnPrint").onclick=()=>window.print();
  document.getElementById("btnReset").onclick=()=>{
    if(!confirm("Naozaj chce≈° resetova≈• v≈°etky ulo≈æen√© zmeny?")) return;
    localStorage.clear();
    loadSettings(); renderRota(); renderChecklists();
    pokladnica={ transactions:[], inventory:JSON.parse(JSON.stringify(DEFAULT_INVENTORY)), names:[...NAMES_DEFAULT] };
    renderAll();
  };

  // =====================================================================
  // INIT
  // =====================================================================
  loadSettings();
  renderRota();
  renderChecklists();
  updatePokladnikInfo();
  syncLoad(); // credentials hardcoded, always sync
  </script>
</body>
</html>
